#==============================================================================
# Configuration GitLab Public Repository Monitor
#==============================================================================

#------------------------------------------------------------------------------
# Configuration GitLab
#------------------------------------------------------------------------------

# URL de l'instance GitLab (sans slash final)
# Exemple: https://gitlab.example.com
GITLAB_URL="https://gitlab.villejuif.fr"

# Note: Aucun token n'est nécessaire pour accéder aux dépôts publics
# Le script utilise l'interface web standard /explore/projects

#------------------------------------------------------------------------------
# Configuration Email
#------------------------------------------------------------------------------

# Langue des notifications (FR ou EN)
# Language for notifications (FR or EN)
NOTIFICATION_LANGUAGE="FR"

# Adresse email de destination pour les notifications
EMAIL_TO="admin@example.com"

# Adresse email d'expéditeur
EMAIL_FROM="gitlab-monitor@example.com"

# Sujet de l'email (peut contenir la variable $REPONAME)
EMAIL_SUBJECT_FR="⚠️ Nouveau dépôt public détecté: \$REPONAME"
EMAIL_SUBJECT_EN="⚠️ New public repository detected: \$REPONAME"

#------------------------------------------------------------------------------
#------------------------------------------------------------------------------
# Template Email Français (Markdown/HTML)
#------------------------------------------------------------------------------

read -r -d '' EMAIL_TEMPLATE_FR << 'EOF'
Bonjour, nous avons détecté la présence d'un dépôt Gitlab accessible publiquement.

C'est la première détection de ce dépôt et **vous ne serez plus notifié à l'avenir.**

| **Nom du dépôt:** \$REPONAME                  | **Dernier commit par:** \$REPODEV                          |
| -------------------------------------------- | --------------------------------------------------------- |
| **Publié à l'adresse:** \$REPOURL             |                                                           |
| **Présence d'une licence:** \$URLLICENSE      |                                                           |
| **Présence d'une documentation:** \$URLREADME | **Présence d'un guide de contribution:** \$URLCONTRIBUTING |

---

### ⚠️ Avertissement Important concernant les Dépôts Publics 

Pour les dépôts accessible publiquement sur Internet, il est **impératif** de respecter les règles suivantes avant toute publication sur notre plateforme Gitlab:

1.  **Aucune Information Sensible ou Spécifique à notre organisation** :
    *   Les scripts publiés ne doivent contenir **aucune information spécifique à notre organisation**. Cela inclut, sans s'y limiter :
        *   Noms de groupes Active Directory/LDAP, noms d'utilisateurs, noms de machines, noms de domaines internes.
        *   Adresses IP internes, noms de serveurs, chemins de fichiers réseau spécifiques, schémas,
        *   **Absolument aucun secret** : mots de passe, clés API, certificats, identifiants, tokens, etc.
    *   Toute information qui pourrait identifier notre infrastructure ou nos pratiques internes doit être **abstraite, généralisée ou supprimée**.
    *   Afin de détecter la présence de secret, vous pouvez utiliser des solution comme [GitLeak](https://github.com/gitleaks/gitleaks) ou, en plus léger, [FindSecretLeak](https://gitlab.villejuif.fr/depots-public/findsecretsleak)
2.  **Conditions d'Éligibilité à la Publication** :
    *   Seuls les scripts/codes **généralistes et réutilisables** dans n'importe quel environnement similaire sont éligibles à la publication publique.
    *   Les scripts doivent être conçus de manière à ne pas dépendre de configurations spécifiques à notre environnement. Si des configurations sont nécessaires, elles doivent être externalisées (ex: fichiers de configuration, paramètres de script) et documentées de manière générique.
3.  **Licence AGPLv3** :
    *   Tous les projets publiés publiquement seront automatiquement placés sous la **licence GNU Affero General Public License v3.0 (AGPLv3)**. Assurez-vous que votre code est compatible avec cette licence.
4.  **Fichier de Contribution** :
    *   Chaque projet publié doit contenir un fichier \`CONTRIBUTING.md\` à sa racine. Ce document doit expliquer clairement quels sont les contribution souhaitées et sous quelles formes.
5.  **Documentation de Qualité (\`README.md\`)** :
    *   Le \`README.md\` doit être **complet, clair et utile**. Il doit inclure une description de l'objectif, le fonctionnement, les instructions d'installation, un tableau des paramètres, et des exemples d'utilisation. L'adjonction de badges ou d'une version bilingue (Francais/Anglais) peut être un plus

Le non-respect de ces règles peut entraîner des risques de sécurité majeurs et la suppression immédiate du contenu publié.

---
EOF

#------------------------------------------------------------------------------
# Template Email English (Markdown/HTML)
#------------------------------------------------------------------------------

read -r -d '' EMAIL_TEMPLATE_EN << 'EOF'
Hello, we have detected the presence of a publicly accessible GitLab repository.

This is the first detection of this repository and **you will not be notified again in the future.**

| **Repository name:** \$REPONAME               | **Last commit by:** \$REPODEV                             |
| -------------------------------------------- | --------------------------------------------------------- |
| **Published at:** \$REPOURL                   |                                                           |
| **License present:** \$URLLICENSE             |                                                           |
| **Documentation present:** \$URLREADME        | **Contribution guide present:** \$URLCONTRIBUTING        |

---

### ⚠️ Important Warning Regarding Public Repositories 

For repositories publicly accessible on the Internet, it is **imperative** to follow these rules before any publication on our GitLab platform:

1.  **No Sensitive or Organization-Specific Information** :
    *   Published scripts must not contain **any organization-specific information**. This includes, but is not limited to:
        *   Active Directory/LDAP group names, usernames, machine names, internal domain names.
        *   Internal IP addresses, server names, specific network file paths, schemas,
        *   **Absolutely no secrets**: passwords, API keys, certificates, credentials, tokens, etc.
    *   Any information that could identify our infrastructure or internal practices must be **abstracted, generalized, or removed**.
    *   To detect the presence of secrets, you can use solutions like [GitLeaks](https://github.com/gitleaks/gitleaks) or, more lightweight, [FindSecretLeak](https://gitlab.villejuif.fr/depots-public/findsecretsleak)
2.  **Publication Eligibility Conditions** :
    *   Only **generic and reusable** scripts/code in any similar environment are eligible for public publication.
    *   Scripts must be designed not to depend on configurations specific to our environment. If configurations are necessary, they must be externalized (e.g., configuration files, script parameters) and documented generically.
3.  **AGPLv3 License** :
    *   All publicly published projects will be automatically placed under the **GNU Affero General Public License v3.0 (AGPLv3)**. Ensure your code is compatible with this license.
4.  **Contribution File** :
    *   Each published project must contain a \`CONTRIBUTING.md\` file at its root. This document must clearly explain what contributions are desired and in what forms.
5.  **Quality Documentation (\`README.md\`)** :
    *   The \`README.md\` must be **complete, clear, and useful**. It must include a description of the objective, operation, installation instructions, parameter table, and usage examples. Adding badges or a bilingual version (French/English) can be a plus.

Non-compliance with these rules can lead to major security risks and immediate removal of published content.

---
EOF

#------------------------------------------------------------------------------
# Configuration avancée
#------------------------------------------------------------------------------

# Timeout pour les appels API (en secondes)
API_TIMEOUT=30

# Niveau de log (DEBUG, INFO, WARN, ERROR)
LOG_LEVEL="INFO"

# Répertoire de travail temporaire (optionnel)
# TEMP_DIR="/tmp/gitlab-monitor"

# Fichier de log personnalisé (optionnel)
# LOG_FILE="/var/log/gitlab-monitor.log"

#------------------------------------------------------------------------------
# Configuration du serveur SMTP (optionnel)
#------------------------------------------------------------------------------

# Si vous utilisez un serveur SMTP externe au lieu de sendmail local
# SMTP_SERVER="smtp.example.com"
# SMTP_PORT="587"
# SMTP_USER="username"
# SMTP_PASS="password"
# SMTP_TLS="true"